@model Hadiyah.Models.PaymentViewModel

@{
    ViewBag.Title = "Card Payment";
}

<div class="py-5">
    <div class="text-center mb-4">
        <h2 class="fw-bold" style="color:#0F2237;">Secure Card Payment</h2>
        <p class="text-muted mb-0">Enter your card details to complete order #@Model.OrderId.</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-7">
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-body p-4">
                    <h5 class="fw-bold mb-3">Billing details</h5>

                    <div class="alert alert-light border rounded-4 d-flex justify-content-between align-items-center mb-4">
                        <div>
                            <div class="text-muted small">Total due</div>
                            <div class="fs-4 fw-bold">@Model.Amount.ToString("0.00") JOD</div>
                        </div>
                        <div class="text-end">
                            <div class="text-muted small">Order date</div>
                            <div>@Model.OrderDate.ToString("yyyy-MM-dd HH:mm")</div>
                        </div>
                    </div>

                    <form asp-action="Payment" method="post" class="row g-3">
                        @Html.AntiForgeryToken()
                        <input type="hidden" asp-for="OrderId" />
                        <input type="hidden" asp-for="Amount" />
                        <input type="hidden" asp-for="OrderDate" />

                        <div asp-validation-summary="ModelOnly" class="alert alert-danger rounded-3" role="alert"></div>

                        <div class="col-12">
                            <label class="form-label">Name on card</label>
                            <input asp-for="CardholderName" class="form-control form-control-lg" placeholder="Full name" />
                            <span class="text-danger small" asp-validation-for="CardholderName"></span>
                        </div>

                        <div class="col-12">
                            <label class="form-label">Card number</label>
                            <input asp-for="CardNumber"
                                   class="form-control form-control-lg"
                                   maxlength="19"
                                   inputmode="numeric"
                                   placeholder="1234 5678 9012 3456"
                                   id="cardNumberInput" />
                            <span class="text-danger small" asp-validation-for="CardNumber"></span>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Expiry month</label>
                            <input asp-for="ExpiryMonth"
                                   type="number"
                                   class="form-control"
                                   placeholder="MM"
                                   min="0"
                                   max="12" />
                            <span class="text-danger small" asp-validation-for="ExpiryMonth"></span>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Expiry year (YY)</label>
                            <input asp-for="ExpiryYear"
                                   class="form-control"
                                   placeholder="YY"
                                   maxlength="2"
                                   inputmode="numeric"
                                   pattern="\d{2}" />
                            <span class="text-danger small" asp-validation-for="ExpiryYear"></span>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">CVV</label>
                            <input asp-for="Cvv"
                                   class="form-control"
                                   placeholder="3-4 digits"
                                   maxlength="4"
                                   inputmode="numeric"
                                   pattern="\d{3,4}" />
                            <span class="text-danger small" asp-validation-for="Cvv"></span>
                        </div>

                        <div class="col-12">
                            <button class="btn btn-primary w-100 py-2 rounded-pill">Pay @Model.Amount.ToString("0.00") JOD</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const cardInput = document.getElementById('cardNumberInput');
            if (cardInput) {
                cardInput.addEventListener('input', function () {
                    let digits = this.value.replace(/\D/g, '').substring(0, 16);
                    const grouped = digits.replace(/(.{4})/g, '$1 ').trim();
                    this.value = grouped;
                });
            }
        });
    </script>
}
